---
title: "MSDS SMU 6372 Project 1"
author: "Rashmi Patel"
date: "5/18/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Importing required libraries
```{r}
#Loading the libraries
library(tidyverse)
library(caret)
library(caTools)
library(Hmisc)
library(lattice)
library(Formula)
library(survival)
library(forecast)
library(corrplot)
library(car)
library(ROCR)
library(Metrics)
library(VIM)
library(rpart)       
library(rpart.plot)  
library(rattle)
library(FNN)
library(knitr)
library(kableExtra)
library(data.table)
library(plyr)
library(DataExplorer)
library(mlbench)
library(caret)
library(olsrr)
library(MASS)
```
## Loading the data
```{r}
# Loading the raw data from GitHub
who.life=read.csv("https://raw.githubusercontent.com/RashmiAPatel19/SMU-6372-Applied-Stats/main/Project1/Life%20Expectancy%20Data.csv", header=TRUE)
# Looking at the first 10 rows of the data
head(who.life,10)

```
## 
```{r}
# Checking the dimensions of the dataset
dim(who.life)
# Checking the column names of the dataset
colnames(who.life)
# Looking at the summary of the dataset
summary(who.life)
# Checking for data types of the columns of the dataset
str(who.life)
# Checking for number of columns with numeric type
numeric_var_who=sum(sapply(who.life[,1:22],is.numeric))
numeric_var_who
# Checking for number of columns with character type
char_var_who=sum(sapply(who.life[,1:22],is.character))
char_var_who
# Checking for column names with numeric type
numeric_varname_who=which(sapply(who.life[,1:22],is.numeric))
numeric_varname_who
# Checking for column names with character type
char_varname_who=which(sapply(who.life[,1:22],is.character))
char_varname_who

```
## Checking for missing values
```{r}
# Checking for missing values
sum(is.na(who.life))
# Representing the columns having NA values in a tabular form
missing_values_who <- colSums(sapply(who.life, is.na))
missing_values_who<- data.frame(who_Variables = names(missing_values_who), who_NA_Count = missing_values_who); rownames(missing_values_who) <- c()
missing_values_who<- missing_values_who %>% filter(who_NA_Count > 0)
kable(missing_values_who, "html") %>%
  kable_styling(full_width = F)
length(missing_values_who$who_Variables)
sum(missing_values_who$who_NA_Count)

# Imputing the missing values by its median of each columns
who2=who.life
for (i in which(sapply(who2, is.numeric))) {
  who2[is.na(who2[, i]), i] <- median(who2[, i],  na.rm = TRUE)
}
#Removing character variable Country and Status
life=who2[,!names(who2) %in% c("Country","Status")]
dim(life)
summary(life$Life.expectancy)
summary(who.life$Life.expectancy)
```
# Looking at the data graphically
```{r}
# Plotting the histogram for data before imputing the median
plot_histogram(who.life)
# Plotting the histogram for data after imputing the median
plot_histogram(life)
# Correlation Plot
corrplot(cor(life), method="number" )
```
Conclusion: 

* Variables with right skewness
  ** Adult.Mortality
  ** Alcohol
  ** GDP
  ** HIV.AIDS
  ** Measles
  ** percentage.expenditure
  ** Population
  ** under.five.deaths
  ** thinness..1.19.years
  ** thinness.5.9.years
  
* Variables with left skewness
  ** Diphthearia
  ** Hepatitis.B
  ** Polio
  ** Income.composition.of.resources
  
* Variables with normal distribution
  ** Schooling    
  ** Life.expectancy
  ** Total.expenditure
  ** BMI
  ** Year  

# EDA
```{r}
# Looking at Status=Developing/Developed
ggplot(who2,aes(x=Status))+geom_bar(position="stack",stat="count",na.rm = TRUE)+
  theme(axis.text.x = element_text(angle = 90))+geom_text(aes(label=..count..),stat="count",position=position_stack(0.5))

# Looking at life expectancy by Year
who2 %>%ggplot()+geom_violin(aes(x=Year, y=Life.expectancy, group=Year, fill=Year))
# not working 
who2 %>%
    group_by(Year) %>% 
    summarize(adultmort=mean(Adult.Mortality),
             infantmort=mean(infant.deaths)) %>% ggplot()+
        geom_smooth(aes(x=Year, adultmort), color='blue', se=FALSE)+
        geom_smooth(aes(x=Year, infantmort), color='red', se=FALSE)
# Schooling vs Alcohol
ggplot(who2,aes(x=Schooling,y=Alcohol))+geom_point()
```

# Basic linear model
```{r}
# model with no imputated data
model1=lm(Life.expectancy~.,data=who.life)
summary(model1)

# model with imputated data
model2=lm(Life.expectancy~.,data=who2)
summary(model2)

# model with no imputation and logged response
model3=lm(log(Life.expectancy)~.,data=who2)
summary(model3)
```
```{r}
# Plot for model 1
par(mfrow=c(2,3))
#Plot includes residuals and Standardized residuals vs fitted values, QQ plot
plot(model1, bg = 'blue', pch=23) 
#Plot cook's distance to detect outliers
plot(cooks.distance(model1), pch=23, bg='maroon', ylab="Cook's distance", 
     main = "Cook's Distance")
#Plot DFFITS to detect outliers
plot(dffits(model1), pch=23, bg='blue', ylab = 'DFFITS', main = 'DFFITS') 

# Plot for model 2
par(mfrow=c(2,3))
#Plot includes residuals and Standardized residuals vs fitted values, QQ plot
plot(model2, bg = 'blue', pch=23) 
#Plot cook's distance to detect outliers
plot(cooks.distance(model2), pch=23, bg='maroon', ylab="Cook's distance", 
     main = "Cook's Distance")
#Plot DFFITS to detect outliers
plot(dffits(model2), pch=23, bg='blue', ylab = 'DFFITS', main = 'DFFITS') 

# Plot for model 3
par(mfrow=c(2,3))
#Plot includes residuals and Standardized residuals vs fitted values, QQ plot
plot(model3, bg = 'blue', pch=23) 
#Plot cook's distance to detect outliers
plot(cooks.distance(model3), pch=23, bg='maroon', ylab="Cook's distance", 
     main = "Cook's Distance")
#Plot DFFITS to detect outliers
plot(dffits(model3), pch=23, bg='blue', ylab = 'DFFITS', main = 'DFFITS') 

```
# Varaiable Selection 
```{r}
# Forward selection
forward=stepAIC(model3,direction = "forward")
forward.model=lm(log(Life.expectancy) ~ Country + Year + Status + Adult.Mortality + 
    infant.deaths + Alcohol + percentage.expenditure + Hepatitis.B + 
    Measles + BMI + under.five.deaths + Polio + Total.expenditure + 
    Diphtheria + HIV.AIDS + GDP + Population + thinness..1.19.years + 
    thinness.5.9.years + Income.composition.of.resources + Schooling,data=who2)
summary(forward.model)

# Backward selection
backward=stepAIC(model3,direction = "backward")
backward.model=lm(log(Life.expectancy) ~ Country + Year + Adult.Mortality + infant.deaths + 
    Alcohol + percentage.expenditure + Hepatitis.B + Measles + 
    under.five.deaths + Polio + Total.expenditure + Diphtheria + 
    HIV.AIDS + GDP + thinness.5.9.years + Schooling
,data=who2)
summary(backward.model)

```
# Splitting the data in train and test set
```{r}
dim(who2)
train.model=createDataPartition(y=who2$Life.expectancy, p = 0.8, list = FALSE)
train=who2[train.model,]
test=who2[-train.model,]
dim(train)
dim(test)
table(is.na(test))
```
  